# xiaohongshuinter PRD

> 小红书自动化工作助手 - 让品牌经理无需实习生即可完成小红书内容搜索、达人发现、内容沉淀等工作

## 1. 项目概述

### 1.1 背景

品牌实习生在小红书上的工作包括：
- 搜索关键词，在符合要求的笔记下方评论
- 沉淀好内容资产（基于关键词搜索筛选近期发布的高互动内容，或依据笔记链接主动搜索）
- 在发现页找到低粉爆款的达人

这些工作原本需要一位实习生拿着一台电脑执行，效率低且人力成本高。

### 1.2 目标

通过自动化工具，让品牌经理只需提前配置任务（点击页面或对话下达），无需实习生就能自动执行流程并交付结果。

### 1.3 目标用户

- **主要用户**：不懂代码的品牌经理
- **使用场景**：日常小红书内容调研、达人合作筛选、内容资产沉淀

---

## 2. 产品形态演进

| 版本 | 形态 | 触发方式 | Skill 执行 | 部署 |
|------|------|----------|------------|------|
| MVP | Web 应用 | 按钮点击 / Chat 对话 | 线性触发 | Vercel |
| 长期 | 桌面应用 | + 任务队列 + 定时触发 | 条件触发 + 并行 | 桌面安装包 |

---

## 3. 功能范围

### 3.1 MVP 功能（验证 1 个 Skill）

```
xiaohongshu-author-finder 跑通
├── 参数配置页面
├── 任务执行（后台）
├── 结果展示 + 导出
└── 邮件通知
```

### 3.2 后续版本功能

| Skill | 功能描述 | 触发入口 |
|-------|----------|----------|
| `xiaohongshu-author-finder` | 发现页找低粉高赞达人 | 按钮：发现达人 |
| `xiaohongshu-comment` | 关键词搜索，在笔记下方评论 | 按钮：批量评论 |
| `xiaohongshu-content-capture` | 基于关键词或链接沉淀内容资产 | 按钮：内容沉淀 |

---

## 4. 技术架构

### 4.1 技术选型

| 层级 | MVP (Web) | 长期 (Desktop) |
|------|-----------|----------------|
| 前端 | Next.js + React | Tauri + React |
| 后端 | Next.js API | Rust 核心 |
| 数据库 | SQLite / PostgreSQL | SQLite |
| 调度 | In-memory queue | Cron + Redis |
| 浏览器 | Puppeteer | MCP |
| 部署 | Vercel | 桌面安装包 |

### 4.2 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      用户层                                  │
│  ┌─────────────┐    ┌─────────────┐                        │
│  │  Web UI     │    │  Chat UI    │                        │
│  │  (Next.js)  │    │  (对话下达)  │                        │
│  └──────┬──────┘    └──────┬──────┘                        │
└─────────┼──────────────────┼───────────────────────────────┘
          │                  │
          ▼                  ▼
┌─────────────────────────────────────────────────────────────┐
│                    API Gateway (Next.js)                     │
│  ┌─────────────┐    ┌─────────────┐    ┌───────────────┐   │
│  │ 任务管理 API │    │ Skill 调用  │    │ 结果查询 API   │   │
│  └──────┬──────┘    └──────┬──────┘    └───────┬───────┘   │
└─────────┼──────────────────┼──────────────────┼───────────┘
          │                  │                  │
          ▼                  ▼                  ▼
┌─────────────────────────────────────────────────────────────┐
│                   任务调度器 (In-memory)                      │
│              ┌──────────────────────────┐                   │
│              │     任务队列管理          │                   │
│              │     重试机制              │                   │
│              │     状态追踪              │                   │
│              └──────────────────────────┘                   │
└─────────────────────────┬───────────────────────────────────┘
                          │
          ┌───────────────┼───────────────┐
          ▼               ▼               ▼
┌──────────────────┐ ┌──────────────┐ ┌──────────────────┐
│  数据库          │ │  Skill 执行  │ │  通知服务        │
│  (SQLite/PG)     │ │  (Puppeteer) │ │  (Email/Feishu)  │
│  - 任务记录      │ │  - MCP 调用  │ │                  │
│  - 执行结果      │ │  - 浏览器控制│ │                  │
│  - 内容资产      │ │              │ │                  │
└──────────────────┘ └──────────────┘ └──────────────────┘
```

---

## 5. 页面结构（MVP）

### 5.1 Dashboard 首页

```
┌─────────────────────────────────────────┐
│  xiaohongshuinter                        │
├─────────────────────────────────────────┤
│                                           │
│  ┌─────────────────────────────────────┐ │
│  │  [创建任务]                          │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  任务列表                                 │
│  ┌─────────────────────────────────────┐ │
│  │ 零食测评达人发现  ▪ 运行中           │ │
│  │ 2024-01-28 10:30                    │ │
│  └─────────────────────────────────────┘ │
│  ┌─────────────────────────────────────┐ │
│  │ 美妆护肤达人发现  ▪ 已完成           │ │
│  │ 2024-01-28 09:15                    │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  统计：运行中 1  │ 已完成 5  │ 失败 0    │
└─────────────────────────────────────────┘
```

### 5.2 创建任务页面

```
┌─────────────────────────────────────────┐
│  创建任务                                 │
├─────────────────────────────────────────┤
│                                           │
│  选择技能                                 │
│  ┌─────────────────────────────────────┐ │
│  │ ○ 内容沉淀                          │ │
│  │ ● 发现达人 (xiaohongshu-author-finder) ✓ │
│  └─────────────────────────────────────┘ │
│                                           │
│  参数配置                                 │
│  ┌─────────────────────────────────────┐ │
│  │ 主题关键词 *      [ 零食测评       ] │ │
│  │ 最小点赞数        [ 50            ] │ │
│  │ 最大粉丝数        [ 1000          ] │ │
│  │ 最大笔记数        [ 30            ] │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  执行方式                                 │
│  ┌─────────────────────────────────────┐ │
│  │ ● 立即执行                          │ │
│  │ ○ 定时执行                          │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  ┌─────────────────────────────────────┐ │
│  │          [开始执行]                  │ │
│  └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 5.3 任务结果页面

```
┌─────────────────────────────────────────┐
│  任务详情：零食测评达人发现                │
├─────────────────────────────────────────┤
│                                           │
│  任务状态：已完成                          │
│  找到作者：12 位                          │
│  执行时间：2024-01-28 10:30 - 10:45      │
│                                           │
│  ┌─────────────────────────────────────┐ │
│  │ 表格：                               │ │
│  │ 作者      │ 链接    │ 点赞 │ 粉丝 │ │ │
│  │ ──────────┼─────────┼──────┼──────│ │ │
│  │ @零食达人1 │ ...    │ 128  │ 856  │ │ │
│  │ @零食达人2 │ ...    │ 256  │ 423  │ │ │
│  │ ...       │ ...    │ ...  │ ...  │ │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  ┌─────────────┐  ┌─────────────┐        │
│  │ [导出 CSV]  │  │ [邮件通知]  │        │
│  └─────────────┘  └─────────────┘        │
│                                           │
│  ┌─────────────────────────────────────┐ │
│  │ 执行日志                            │ │
│  │ 10:30:02 - 任务开始                 │ │
│  │ 10:30:05 - 打开小红书发现页         │ │
│  │ ...                                 │ │
│  │ 10:45:00 - 任务完成                 │ │
│  └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 6. 数据模型

### 6.1 任务定义

```typescript
interface Task {
  id: string;
  skillName: string;
  status: 'pending' | 'running' | 'completed' | 'failed' | 'paused';
  params: Record<string, any>;
  createdAt: string;
  startedAt?: string;
  completedAt?: string;
  errorMessage?: string;
  retryCount: number;
  maxRetries: number;
}
```

### 6.2 作者发现结果

```typescript
interface AuthorResult {
  id: string;
  taskId: string;
  noteUrl: string;
  authorName: string;
  authorUrl: string;
  likes: number;
  followers: number;
  followedAt: string;
  // MVP 后迭代
  // noteContent?: string;     // 全文
  // screenshot?: string;      // 截图路径
  // comment?: string;         // 评​​论内容
}
```

### 6.3 执行日志

```typescript
interface ExecutionLog {
  id: string;
  taskId: string;
  timestamp: string;
  level: 'info' | 'warn' | 'error';
  message: string;
  details?: Record<string, any>;
}
```

---

## 7. 失败处理机制

### 7.1 错误类型与处理策略

| 错误类型 | 触发场景 | 处理策略 |
|----------|----------|----------|
| **结构变化** | 元素 UID 不存在 | 尝试备用选择器 → 跳过该元素，记录日志 |
| **网络超时** | 页面加载超时 | 重试 1 次 → 跳过该步骤 |
| **导航失败** | 页面打不开 | 重试 1 次 → 跳过，继续后续步骤 |
| **元素不可见** | 被遮挡/未加载 | 等待 2s 重试 → 跳过 |
| **权限不足** | 需要登录 | 暂停任务，通知"请登录" |
| **MCP 断开** | 连接中断 | 尝试重连 1 次 → 失败则暂停 |

### 7.2 核心原则

- 单点失败不中断整体流程
- 跳过时记录原因，汇总到结果中
- 严重错误（登录态）才暂停任务

---

## 8. 通知方式

| 方式 | MVP 推荐度 | 说明 |
|------|------------|------|
| **邮件** | ⭐⭐⭐⭐⭐ | SMTP 配置简单，nodemailer 几行代码 |
| **飞书** | ⭐⭐⭐ | 需要 Webhook 配置，更实用但更复杂 |

**建议 MVP 用邮件**，够简单。飞书 webhook 可后续迭代。

---

## 9. Skill 执行机制

### 9.1 循环调用

MVP 阶段：**Skill 自己循环调用自己**
- Skill 内部维护循环逻辑
- 每次滚动加载后验证数据，满足条件则记录

后续迭代：**外层调度器循环调用 Skill**
- 调度器控制调用频率和次数
- Skill 专注单一任务

### 9.2 任务队列

```
┌─────────────────────────────────────────┐
│              任务队列                    │
├─────────────────────────────────────────┤
│  1. [运行中] 零食测评 - xiaohongshu-author-finder │
│  2. [待执行] 美妆护肤 - xiaohongshu-author-finder │
│  3. [待执行] 母婴好物 - xiaohongshu-comment       │
└─────────────────────────────────────────┘
```

---

## 10. MVP 验收标准

### 功能

- [ ] 用户可以在页面创建任务
- [ ] 可以选择 `xiaohongshu-author-finder` Skill
- [ ] 可以配置关键词、最小点赞、最大粉丝数等参数
- [ ] 任务可以后台执行，页面可以查看状态
- [ ] 任务完成后可以查看结果表格
- [ ] 可以导出 CSV
- [ ] 可以收到邮件通知

### 非功能

- [ ] 单点失败不导致整个任务崩溃
- [ ] 任务执行超时保护（最多 N 分钟）
- [ ] 页面刷新不影响任务执行
- [ ] 错误信息清晰可查

---

## 11. 后续迭代方向

### 短期迭代

- [ ] 支持更多 Skill（评论、内容沉淀）
- [ ] 任务队列管理
- [ ] 飞书 Webhook 通知

### 长期迭代

- [ ] 桌面应用（Tauri）
- [ ] 定时触发任务
- [ ] 条件触发（如新笔记发现）
- [ ] AI 自动生成评论内容
- [ ] 多账号管理

---

## 12. 风险与应对

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 小红书页面改版 | 选择器失效 | 备用选择器 + 日志记录 |
| 账号被限制 | 无法继续操作 | 多账号轮换 + 频率控制 |
| 任务丢失 | 后台执行中断 | 任务状态持久化 |
| 数据泄露 | 敏感信息暴露 | 加密存储 + 访问控制 |

---

## 附录：Skill 定义

### xiaohongshu-author-finder

**触发条件**：
- 用户下达"找到 xx 主题，点赞 xx 以上，粉丝 xx 以下的作者"

**输入参数**：
```typescript
{
  keyword: string;      // 搜索关键词
  minLikes: number;     // 最小点赞数
  maxFollowers: number; // 最大粉丝数
  maxNotes: number;     // 最大结果数
}
```

**输出结果**：
```typescript
{
  authors: Array<{
    authorName: string;
    authorUrl: string;
    noteUrl: string;
    likes: number;
    followers: number;
  }>;
  totalFound: number;
  errors: Array<{ step: string; message: string }>;
}
```
